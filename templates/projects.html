{% extends "base.html" %}

{% block title %}My Projects{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/projects.css') }}">
{% endblock %}

{% block content %}
<div class="projects-container">
    <div class="projects-header">
        <h1>My Projects</h1>
        {% if current_user.is_administrator() %}
        <a href="{{ url_for('create_project') }}" class="btn create-project-btn">
            <i class="fas fa-plus"></i> New Project
        </a>
        {% endif %}
    </div>

    <div class="projects-filters">
        <div class="search-box">
            <input type="text" placeholder="Search projects..." id="projectSearch">
        </div>
        <div class="filter-options">
            <select id="statusFilter">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="completed">Completed</option>
                <option value="on_hold">On Hold</option>
                <option value="archived">Archived</option>
            </select>
            <select id="priorityFilter">
                <option value="">All Priorities</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
        </div>
    </div>

    <div class="projects-grid">
        {% for project in projects %}
        <div class="project-card">
            <h3 class="project-title">
                <a href="{{ url_for('view_project', project_id=project.id) }}" class="project-title">
                    {{ project.title }}
                </a>
            </h3>
            <p class="project-description">{{ project.description[:100] }}{% if project.description|length > 100 %}...{% endif %}</p>
            
            <div class="project-actions">
                {% if project.features %}
                <button class="features-btn" 
                        data-features='{{ project.features|tojson|safe }}'
                        data-title="{{ project.title|e }}">
                    <i class="fas fa-list"></i> View Features
                </button>
                {% endif %}
                
                {% if project.project_url %}
                <a href="{{ project.project_url }}" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="url-button">
                    <i class="fas fa-external-link-alt"></i> Visit Project
                </a>
                {% endif %}
            </div>
            
            <div class="project-meta">
                <div class="meta-info">
                    <span class="meta-label">@{{ project.owner.username }}</span>
                    <span class="status-badge {{ project.status }}">{{ project.status }}</span>
                </div>
            </div>
            <div class="task-stats">
                <span class="task-count open">{{ project.tasks|selectattr('status', 'equalto', 'open')|list|length }} open</span>
                <span class="task-count assigned">{{ project.tasks|selectattr('assigned_to_id')|list|length }} assigned</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Features Modal -->
<div id="featuresModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle"></h2>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <ul id="featuresList"></ul>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add click listeners for feature buttons
    document.querySelectorAll('.features-btn').forEach(button => {
        button.addEventListener('click', function() {
            const features = JSON.parse(this.dataset.features);
            const title = this.dataset.title;
            showFeatures(features, title);
        });
    });

    // Show features modal
    function showFeatures(features, projectTitle) {
        const modal = document.getElementById('featuresModal');
        const modalTitle = document.getElementById('modalTitle');
        const featuresList = document.getElementById('featuresList');
        
        modalTitle.textContent = projectTitle + ' - Features';
        featuresList.innerHTML = features.map(feature => `<li>${feature}</li>`).join('');
        modal.style.display = 'block';
    }

    // Close modal when clicking the X button
    document.querySelector('.close-modal').addEventListener('click', function() {
        document.getElementById('featuresModal').style.display = 'none';
    });

    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('featuresModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
});
</script>
{% endblock %} 